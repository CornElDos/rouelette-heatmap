<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Roulette Heatmap App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .hidden {
      display: none;
    }
    .roulette-grid {
      display: grid;
      grid-gap: 5px;
      justify-content: center;
    }
    .roulette-button {
      width: 50px;
      height: 50px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      background-color: #f9f9f9;
    }
    .selected-numbers {
      margin: 10px 0;
    }
    table {
      border-collapse: collapse;
      margin: 10px auto;
    }
    td {
      border: 1px solid #000;
      width: 50px;
      height: 50px;
      text-align: center;
      vertical-align: middle;
      font-size: 16px;
    }
    .heatmap-cell {
      transition: background-color 0.3s;
    }
    #resetNumbers {
      margin-top: 10px;
      padding: 5px 10px;
      font-size: 16px;
      cursor: pointer;
    }
    #lineCounterDisplay, #columnCounterDisplay {
      margin-top: 15px;
      text-align: center;
    }
    /* Bet suggestion area */
    #betSuggestionArea {
      margin-top: 20px;
      border: 1px solid #000;
      padding: 10px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    #betSuggestionArea h3 {
      margin-top: 0;
    }
    .form-row {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Roulette Heatmap App</h1>
  
  <!-- Step 1: Choose table type -->
  <div id="rouletteTypeSelection">
    <p>Choose table type:</p>
    <label>
      <input type="radio" name="tableType" value="european" checked> Single zero (European)
    </label>
    <label>
      <input type="radio" name="tableType" value="american"> 0/00 (American)
    </label>
    <button id="confirmType">Confirm</button>
  </div>

  <!-- Step 1b: Ask for bankroll and bet type (once table type is confirmed) -->
  <div id="bankrollSection" class="hidden">
    <div class="form-row">
      <label for="bankrollInput">Enter your bankroll:</label><br>
      <input type="number" id="bankrollInput" min="1" value="1000">
    </div>
    <div class="form-row">
      <label>Choose stake style:</label><br>
      <input type="radio" name="stakeStyle" value="fixed" checked> Fixed amount<br>
      <input type="radio" name="stakeStyle" value="percent"> Percentage of bankroll
    </div>
    <div class="form-row" id="baseBetRow">
      <label for="baseBetInput">Base bet (units):</label><br>
      <input type="number" id="baseBetInput" min="1" value="10">
    </div>
    <div class="form-row hidden" id="basePercentRow">
      <label for="basePercentInput">Base percentage (%):</label><br>
      <input type="number" id="basePercentInput" min="1" max="100" value="10">
    </div>
    <button id="confirmBankroll">Confirm Bankroll</button>
  </div>

  <!-- Step 2: Enter the numbers that hit the table -->
  <div id="numberInputSection" class="hidden">
    <p>Click on the numbers that hit the roulette table:</p>
    <div id="numberGrid" class="roulette-grid"></div>
    <div class="selected-numbers">
      Selected numbers: <span id="selectedNumbersDisplay"></span>
    </div>
    <!-- Reset button to clear the entered numbers -->
    <button id="resetNumbers">Reset</button>

    <!-- Line gap display -->
    <div id="lineCounterDisplay"></div>
    <!-- Column gap display -->
    <div id="columnCounterDisplay"></div>
  </div>

  <!-- Step 3: Choose which heatmap to display -->
  <div id="heatmapOptions" class="hidden">
    <p>Choose which heatmap you want to display:</p>
    <button id="showStandardHeatmap">Show standard roulette heatmap</button>
    <button id="showRacetrackHeatmap">Show racetrack heatmap</button>
  </div>

  <!-- Heatmap display area -->
  <div id="heatmapDisplay" class="hidden">
    <!-- The heatmap layout will be rendered here -->
  </div>

  <!-- Bet Suggestion Section -->
  <div id="betSuggestionArea" class="hidden">
    <h3>Bet Suggestion</h3>
    <p><strong>Bankroll:</strong> <span id="bankrollDisplay"></span></p>
    <p><strong>Suggested Bet:</strong> <span id="suggestedBetDisplay"></span></p>
    <p><strong>Bet Size:</strong> <span id="betSizeDisplay"></span></p>
    <p><strong>Last Bet Result:</strong> <span id="lastBetResultDisplay">N/A</span></p>
  </div>

  <script>
    // --- Global Variables ---
    let tableType = 'european';  // Default is European (single zero)
    let selectedNumbers = [];
    const minSpinsForHeatmap = 5; // At least 5 numbers are required to display the heatmap

    let currentHeatmapLayout = null;

    // Bankroll and bet info
    let bankroll = 1000;
    let stakeStyle = 'fixed';  // or 'percent'
    let baseBet = 10;
    let basePercent = 10;

    // Current bet suggestion
    let currentBet = {
      betType: null,          // 'line' or 'column'
      betTarget: null,        // e.g. "Line 3" or "Column 2"
      betSize: 0,             // how much we will bet
      cumulativeLosses: 0     // track total losses to recoup
    };

    // Define the 6 line groups (line bets) – only numbers 1-36 are considered
    const lineGroups = [
      { name: "Line 1", numbers: ["1", "2", "3", "4", "5", "6"] },
      { name: "Line 2", numbers: ["7", "8", "9", "10", "11", "12"] },
      { name: "Line 3", numbers: ["13", "14", "15", "16", "17", "18"] },
      { name: "Line 4", numbers: ["19", "20", "21", "22", "23", "24"] },
      { name: "Line 5", numbers: ["25", "26", "27", "28", "29", "30"] },
      { name: "Line 6", numbers: ["31", "32", "33", "34", "35", "36"] }
    ];

    // Define the 3 column groups – also only numbers 1-36
    const columnGroups = [
      { name: "Column 1", numbers: ["1","4","7","10","13","16","19","22","25","28","31","34"] },
      { name: "Column 2", numbers: ["2","5","8","11","14","17","20","23","26","29","32","35"] },
      { name: "Column 3", numbers: ["3","6","9","12","15","18","21","24","27","30","33","36"] }
    ];

    // Element references
    const rouletteTypeSelectionDiv = document.getElementById('rouletteTypeSelection');
    const bankrollSectionDiv = document.getElementById('bankrollSection');
    const numberInputSectionDiv = document.getElementById('numberInputSection');
    const heatmapOptionsDiv = document.getElementById('heatmapOptions');
    const heatmapDisplayDiv = document.getElementById('heatmapDisplay');
    const selectedNumbersDisplay = document.getElementById('selectedNumbersDisplay');
    const numberGridDiv = document.getElementById('numberGrid');
    const resetButton = document.getElementById('resetNumbers');

    // Bet suggestion area
    const betSuggestionAreaDiv = document.getElementById('betSuggestionArea');
    const bankrollDisplay = document.getElementById('bankrollDisplay');
    const suggestedBetDisplay = document.getElementById('suggestedBetDisplay');
    const betSizeDisplay = document.getElementById('betSizeDisplay');
    const lastBetResultDisplay = document.getElementById('lastBetResultDisplay');

    // --- Event Handlers ---
    document.getElementById('confirmType').addEventListener('click', function() {
      // Read the selected table type
      const radios = document.getElementsByName('tableType');
      for (let radio of radios) {
        if (radio.checked) {
          tableType = radio.value;
          break;
        }
      }
      // Hide the table type selection and show the bankroll section
      rouletteTypeSelectionDiv.classList.add('hidden');
      bankrollSectionDiv.classList.remove('hidden');
    });

    // Switch between fixed bet input and percentage input
    const stakeStyleRadios = document.getElementsByName('stakeStyle');
    stakeStyleRadios.forEach(radio => {
      radio.addEventListener('change', function() {
        stakeStyle = this.value;
        toggleBetInput();
      });
    });

    function toggleBetInput() {
      const baseBetRow = document.getElementById('baseBetRow');
      const basePercentRow = document.getElementById('basePercentRow');
      if (stakeStyle === 'fixed') {
        baseBetRow.classList.remove('hidden');
        basePercentRow.classList.add('hidden');
      } else {
        baseBetRow.classList.add('hidden');
        basePercentRow.classList.remove('hidden');
      }
    }

    document.getElementById('confirmBankroll').addEventListener('click', function() {
      // Read bankroll
      bankroll = parseInt(document.getElementById('bankrollInput').value) || 1000;
      stakeStyle = [...stakeStyleRadios].find(r => r.checked).value;
      baseBet = parseInt(document.getElementById('baseBetInput').value) || 10;
      basePercent = parseInt(document.getElementById('basePercentInput').value) || 10;

      // Hide bankroll section, show number input
      bankrollSectionDiv.classList.add('hidden');
      setupNumberGrid();
      numberInputSectionDiv.classList.remove('hidden');
      updateLineCounters();
      updateColumnCounters();

      // Initialize bet suggestion
      betSuggestionAreaDiv.classList.remove('hidden');
      updateBetSuggestion(); // will show "N/A" until we have 5 spins
      displayBankroll();
    });

    function setupNumberGrid() {
      numberGridDiv.innerHTML = '';
      let numbers = [];
      if (tableType === 'european') {
        // European: 0 and 1-36
        numbers.push('0');
        for (let i = 1; i <= 36; i++) {
          numbers.push(i.toString());
        }
      } else {
        // American: 0, 00 and 1-36
        numbers.push('0');
        numbers.push('00');
        for (let i = 1; i <= 36; i++) {
          numbers.push(i.toString());
        }
      }
      // Create a button for each number.
      numbers.forEach(num => {
        let btn = document.createElement('button');
        btn.textContent = num;
        btn.className = 'roulette-button';
        btn.dataset.number = num;
        btn.dataset.count = 0;
        btn.addEventListener('click', function() {
          // Add the number to the list
          selectedNumbers.push(num);
          updateSelectedNumbersDisplay();

          // Update the count on the button
          let currentCount = parseInt(btn.dataset.count);
          currentCount++;
          btn.dataset.count = currentCount;
          btn.textContent = num + (currentCount > 0 ? ' (' + currentCount + ')' : '');

          // Show heatmap options as soon as at least 5 numbers have been registered
          if (selectedNumbers.length >= minSpinsForHeatmap) {
            heatmapOptionsDiv.classList.remove('hidden');
          }
          // Update heatmap if already visible
          if (currentHeatmapLayout !== null) {
            displayHeatmap(currentHeatmapLayout);
          }
          // Update line and column counters each spin
          updateLineCounters();
          updateColumnCounters();

          // Check if the last suggested bet was a win or a loss
          checkLastBetResult(num);
          // Then propose a new bet (or update the current one) if we have enough data
          updateBetSuggestion();
        });
        numberGridDiv.appendChild(btn);
      });
      // Adjust grid layout (e.g., 6 columns)
      numberGridDiv.style.gridTemplateColumns = 'repeat(6, 50px)';
    }

    function updateSelectedNumbersDisplay() {
      selectedNumbersDisplay.textContent = selectedNumbers.join(', ');
    }

    // --- Line & Column Gaps ---
    function updateLineCounters() {
      let displayHTML = "<h3>Line Gaps</h3>";
      lineGroups.forEach(group => {
        let lastIndex = -1;
        for (let i = selectedNumbers.length - 1; i >= 0; i--) {
          if (group.numbers.includes(selectedNumbers[i])) {
            lastIndex = i;
            break;
          }
        }
        let gap = (lastIndex === -1) ? selectedNumbers.length : (selectedNumbers.length - lastIndex - 1);
        displayHTML += `<p>${group.name}: ${gap} spin(s) since win</p>`;
      });
      document.getElementById("lineCounterDisplay").innerHTML = displayHTML;
    }

    function updateColumnCounters() {
      let displayHTML = "<h3>Column Gaps</h3>";
      columnGroups.forEach(group => {
        let lastIndex = -1;
        for (let i = selectedNumbers.length - 1; i >= 0; i--) {
          if (group.numbers.includes(selectedNumbers[i])) {
            lastIndex = i;
            break;
          }
        }
        let gap = (lastIndex === -1) ? selectedNumbers.length : (selectedNumbers.length - lastIndex - 1);
        displayHTML += `<p>${group.name}: ${gap} spin(s) since win</p>`;
      });
      document.getElementById("columnCounterDisplay").innerHTML = displayHTML;
    }

    // --- Heatmap ---
    function getColorForCount(count) {
      if (count === 0) return '#fff';
      if (count === 1) return '#ffcccc';
      if (count === 2) return '#ff9999';
      if (count >= 3) return '#ff6666';
      return '#fff';
    }

    document.getElementById('showStandardHeatmap').addEventListener('click', function() {
      currentHeatmapLayout = 'standard';
      displayHeatmap('standard');
    });
    document.getElementById('showRacetrackHeatmap').addEventListener('click', function() {
      currentHeatmapLayout = 'racetrack';
      displayHeatmap('racetrack');
    });

    function getNumberFrequencies() {
      let frequencies = {};
      let possibleNumbers = [];
      if (tableType === 'european') {
        possibleNumbers.push('0');
        for (let i = 1; i <= 36; i++) {
          possibleNumbers.push(i.toString());
        }
      } else {
        possibleNumbers.push('0', '00');
        for (let i = 1; i <= 36; i++) {
          possibleNumbers.push(i.toString());
        }
      }
      possibleNumbers.forEach(num => frequencies[num] = 0);
      selectedNumbers.forEach(num => {
        if (frequencies[num] !== undefined) {
          frequencies[num]++;
        }
      });
      return frequencies;
    }

    function displayHeatmap(layoutType) {
      heatmapDisplayDiv.innerHTML = '';
      heatmapDisplayDiv.classList.remove('hidden');
      const frequencies = getNumberFrequencies();

      if (layoutType === 'standard') {
        let table = document.createElement('table');
        if (tableType === 'european') {
          // Top row with 0 spanning three columns
          let row0 = document.createElement('tr');
          let cell0 = document.createElement('td');
          cell0.colSpan = 3;
          cell0.textContent = '0';
          cell0.className = 'heatmap-cell';
          cell0.style.backgroundColor = getColorForCount(frequencies['0']);
          row0.appendChild(cell0);
          table.appendChild(row0);
          // Rows for numbers 1-36 in 12 rows of 3 columns each
          for (let i = 0; i < 12; i++) {
            let row = document.createElement('tr');
            for (let j = 0; j < 3; j++) {
              let num = (i * 3 + j + 1).toString();
              let cell = document.createElement('td');
              cell.textContent = num;
              cell.className = 'heatmap-cell';
              cell.style.backgroundColor = getColorForCount(frequencies[num]);
              row.appendChild(cell);
            }
            table.appendChild(row);
          }
        } else {
          // American layout
          let row0 = document.createElement('tr');
          let cell0 = document.createElement('td');
          cell0.textContent = '0';
          cell0.className = 'heatmap-cell';
          cell0.style.backgroundColor = getColorForCount(frequencies['0']);
          row0.appendChild(cell0);
          let cell00 = document.createElement('td');
          cell00.textContent = '00';
          cell00.className = 'heatmap-cell';
          cell00.style.backgroundColor = getColorForCount(frequencies['00']);
          cell00.colSpan = 2;
          row0.appendChild(cell00);
          table.appendChild(row0);
          // Rows for numbers 1-36
          for (let i = 0; i < 12; i++) {
            let row = document.createElement('tr');
            for (let j = 0; j < 3; j++) {
              let num = (i * 3 + j + 1).toString();
              let cell = document.createElement('td');
              cell.textContent = num;
              cell.className = 'heatmap-cell';
              cell.style.backgroundColor = getColorForCount(frequencies[num]);
              row.appendChild(cell);
            }
            table.appendChild(row);
          }
        }
        heatmapDisplayDiv.appendChild(table);
      } else {
        // Racetrack
        let racetrackDiv = document.createElement('div');
        racetrackDiv.style.display = 'flex';
        racetrackDiv.style.flexWrap = 'wrap';
        racetrackDiv.style.justifyContent = 'center';
        let wheelOrder = [];
        if (tableType === 'european') {
          wheelOrder = ['0', '32', '15', '19', '4', '21', '2', '25', '17', '34', '6', '27', '13', '36', '11', '30', '8', '23', '10', '5', '24', '16', '33', '1', '20', '14', '31', '9', '22', '18', '29', '7', '28', '12', '35', '3', '26'];
        } else {
          wheelOrder = ['0', '28', '9', '26', '30', '11', '7', '20', '32', '17', '5', '22', '34', '15', '3', '24', '36', '13', '1', '00', '27', '10', '25', '29', '12', '8', '19', '31', '18', '6', '21', '4', '2', '23', '35', '14', '16'];
        }
        wheelOrder.forEach(num => {
          let box = document.createElement('div');
          box.textContent = num;
          box.style.width = '40px';
          box.style.height = '40px';
          box.style.display = 'flex';
          box.style.justifyContent = 'center';
          box.style.alignItems = 'center';
          box.style.margin = '2px';
          box.style.border = '1px solid #000';
          box.style.borderRadius = '4px';
          box.style.backgroundColor = getColorForCount(frequencies[num] || 0);
          racetrackDiv.appendChild(box);
        });
        heatmapDisplayDiv.appendChild(racetrackDiv);
      }
    }

    // --- Reset Functionality ---
    resetButton.addEventListener('click', function() {
      selectedNumbers = [];
      updateSelectedNumbersDisplay();
      if (selectedNumbers.length < minSpinsForHeatmap) {
        heatmapOptionsDiv.classList.add('hidden');
      }
      const buttons = numberGridDiv.getElementsByClassName('roulette-button');
      for (let btn of buttons) {
        btn.dataset.count = 0;
        btn.textContent = btn.dataset.number;
      }
      heatmapDisplayDiv.innerHTML = '';
      heatmapDisplayDiv.classList.add('hidden');
      currentHeatmapLayout = null;
      updateLineCounters();
      updateColumnCounters();

      // Reset the bet suggestion
      currentBet.betType = null;
      currentBet.betTarget = null;
      currentBet.betSize = 0;
      currentBet.cumulativeLosses = 0;
      displayBankroll();
      updateBetSuggestion(true); // Force an update that basically says "N/A" again
      lastBetResultDisplay.textContent = 'N/A';
    });

    // --- Bet Suggestion Logic ---

    // 1) Figure out if the last bet was a win or loss, update bankroll accordingly
    function checkLastBetResult(latestNumber) {
      if (!currentBet.betTarget || !currentBet.betType || currentBet.betSize === 0) {
        // No bet was suggested or no bet size set yet
        return;
      }
      // If we don't have at least 5 spins or a bet was not "active," do nothing
      // We'll consider the bet active if currentBet.betSize > 0

      // Check if latestNumber is in the bet's group
      let groupArray = currentBet.betType === 'line' ? lineGroups : columnGroups;
      let targetGroup = groupArray.find(g => g.name === currentBet.betTarget);
      if (!targetGroup) return;

      // If the group contains the latestNumber => it's a win
      if (targetGroup.numbers.includes(latestNumber)) {
        // Win
        lastBetResultDisplay.textContent = 'WIN';
        // Payout logic: line bet pays 5:1, column pays 2:1 in real roulette
        // but let's keep it simple. We'll treat line bet as 5:1, column bet as 2:1
        let multiplier = (currentBet.betType === 'line') ? 5 : 2;
        let winAmount = currentBet.betSize * multiplier;
        bankroll += winAmount; // add the winnings
        currentBet.cumulativeLosses = 0; // reset
        // Next bet returns to base stake
      } else {
        // Loss
        lastBetResultDisplay.textContent = 'LOSS';
        bankroll -= currentBet.betSize; // subtract the stake
        currentBet.cumulativeLosses += currentBet.betSize; 
      }
      displayBankroll();
    }

    // 2) Suggest or update the next bet
    function updateBetSuggestion(resetToNA = false) {
      // If resetToNA is true, just show "N/A"
      if (resetToNA) {
        suggestedBetDisplay.textContent = 'N/A';
        betSizeDisplay.textContent = 'N/A';
        return;
      }

      // We only suggest a bet if we have at least 5 spins
      if (selectedNumbers.length < 5) {
        suggestedBetDisplay.textContent = 'Not enough spins yet...';
        betSizeDisplay.textContent = 'N/A';
        return;
      }

      // 2a) Pick the group with the highest gap from lines + columns
      let bestLine = getMaxGapGroup(lineGroups);
      let bestColumn = getMaxGapGroup(columnGroups);

      // Compare which has the bigger gap
      if (bestLine.gap >= bestColumn.gap) {
        currentBet.betType = 'line';
        currentBet.betTarget = bestLine.name; // e.g. "Line 3"
      } else {
        currentBet.betType = 'column';
        currentBet.betTarget = bestColumn.name; // e.g. "Column 2"
      }

      // 2b) Calculate the next bet size
      // If we have no cumulativeLosses, it's the base bet
      // else do a simple "recover + 1" approach
      let nextBet = 0;
      if (currentBet.cumulativeLosses === 0) {
        // base stake
        if (stakeStyle === 'fixed') {
          nextBet = baseBet;
        } else {
          // percent of bankroll
          nextBet = Math.floor((bankroll * basePercent) / 100);
          if (nextBet < 1) nextBet = 1; // ensure at least 1
        }
      } else {
        // Martingale style: recover all previous losses + 1 unit
        // Note: real line bet pays 5:1, column pays 2:1; we’ll do a simple approach
        let payoutMultiplier = (currentBet.betType === 'line') ? 5 : 2;
        // If we want to recover currentBet.cumulativeLosses + 1
        // nextBet * payoutMultiplier = cumulativeLosses + nextBet + 1
        // nextBet * (payoutMultiplier - 1) = cumulativeLosses + 1
        // nextBet = (cumulativeLosses + 1) / (payoutMultiplier - 1)
        nextBet = Math.ceil((currentBet.cumulativeLosses + 1) / (payoutMultiplier - 1));
      }

      currentBet.betSize = nextBet;

      // Update the UI
      suggestedBetDisplay.textContent = `${currentBet.betTarget} (${currentBet.betType})`;
      betSizeDisplay.textContent = currentBet.betSize.toString();
    }

    // Helper to find the group with the maximum gap
    function getMaxGapGroup(groupArray) {
      let bestGroup = { name: '', gap: -1 };
      for (let group of groupArray) {
        let lastIndex = -1;
        for (let i = selectedNumbers.length - 1; i >= 0; i--) {
          if (group.numbers.includes(selectedNumbers[i])) {
            lastIndex = i;
            break;
          }
        }
        let gap = (lastIndex === -1) ? selectedNumbers.length : (selectedNumbers.length - lastIndex - 1);
        if (gap > bestGroup.gap) {
          bestGroup.name = group.name;
          bestGroup.gap = gap;
        }
      }
      return bestGroup;
    }

    function displayBankroll() {
      bankrollDisplay.textContent = bankroll.toString();
    }
  </script>
</body>
</html>
